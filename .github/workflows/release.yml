  name: 'Release'
  
  on:
    workflow_dispatch:
      inputs:
        version_suffix:
          description: Suffix of the version number. Can be used to create a preview package.
          required: false
          type: string

  env:
    configuration: Release
    version_suffix: ${{ github.event.inputs.version_suffix }}
  
  jobs:
    build-and-publish:
      runs-on: 'ubuntu-latest'
      permissions:
        id-token: write  # enable GitHub OIDC token issuance for this job

      steps:
        - name: Get Source
          uses: actions/checkout@v5

        - name: Install .NET Core SDK
          uses: actions/setup-dotnet@v5
          with:
            dotnet-version: |
              8.0.x
              9.0.x
              10.0.x
          
        - name: Pack release version
          run: dotnet pack --nologo -c ${{ env.configuration }} --version-suffix "${{ env.version_suffix }}" -o Nuget

        - name: NuGet login (OIDC â†’ temp API key)
          uses: NuGet/login@v1
          id: login
          with:
            user: ${{ secrets.NUGET_USER }}
    
        - name: Publish to nuget org
          run: dotnet nuget push "*.nupkg" --api-key ${{steps.login.outputs.NUGET_API_KEY}} -s nuget.org
          working-directory: './Nuget'